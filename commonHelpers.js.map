{"version":3,"file":"commonHelpers.js","sources":["../src/img/empty_cart/empty-cart-desktop-1x.png","../src/img/empty_cart/empty-cart-desktop-2x.png","../src/img/empty_cart/empty-cart-tab-1x.png","../src/img/empty_cart/empty-cart-tab-2x.png","../src/img/empty_cart/empty-cart-mob-1x.png","../src/img/empty_cart/empty-cart-mob-2x.png","../src/js/markup_cart.js","../src/js/cart_products.js","../src/js/cart_checkout.js"],"sourcesContent":["export default \"__VITE_ASSET__0fb79dcc__\"","export default \"__VITE_ASSET__23d539d9__\"","export default \"__VITE_ASSET__ad0906b6__\"","export default \"__VITE_ASSET__a95b529b__\"","export default \"__VITE_ASSET__032cbbaa__\"","export default \"__VITE_ASSET__c571d517__\"","import icons from '../img/symbol-defs.svg';\nimport imgecd_1x from '../img/empty_cart/empty-cart-desktop-1x.png';\nimport imgecd_2x from '../img/empty_cart/empty-cart-desktop-2x.png';\nimport imgect_1x from '../img/empty_cart/empty-cart-tab-1x.png';\nimport imgect_2x from '../img/empty_cart/empty-cart-tab-2x.png';\nimport imgecm_1x from '../img/empty_cart/empty-cart-mob-1x.png';\nimport imgecm_2x from '../img/empty_cart/empty-cart-mob-2x.png';\n\nexport const getEmptyCartMarkup = () =>\n  `<div class=\"empty-cart\">\n      <div class=\"empty-picture\">\n      <picture>\n          <source\n            srcset=\"\n              ${imgecd_1x} 1x,\n              ${imgecd_2x} 2x\n            \"\n            media=\"\n            (min-width: 1440px)\"\n          />\n          <source\n            srcset=\"\n              ${imgect_1x} 1x,\n              ${imgect_2x} 2x\n            \"\n            media=\"\n            (min-width: 768px)\"\n          />\n          <source\n            srcset=\"\n             ${imgecm_1x} 1x,\n              ${imgecm_2x} 2x\n            \"\n            media=\"\n            (min-width: 375px)\"\n          />\n          <img\n            src=\"/img/empty_cart/empty-cart-mob-1x.png\"\n            alt=\"Empty Cart Image\"\n            class=\"empty-cart-image\"\n          />\n        </picture>\n        </div>\n        <div class=\"empty-text\">\n        <h2 class=\"empty-cart-title\">\n          Your basket is <span class=\"empty-cart-title-span\">empty...</span>\n        </h2>\n        <p class=\"empty-cart-text\">\n          Go to the main page to select your favorite products and add them to\n          the cart.\n        </p></div></div>\n    `;\n\nexport const getCartMarkup = products =>\n  `\n  <div>\n     <div class=\"delete-all\">\n    <button type=\"button\" class=\"btn-delete-all\"> Delete All \n      <span class=\"icon-close\">\n        <svg class=\"icon-close\" width=\"24\" height=\"24\">\n          <use href=\"/img/symbol-defs.svg#icon-ion_close-sharp\"></use>\n        </svg>\n      </span>\n    </button>\n  </div>\n  <ul class=\"cart-products-list\">\n    ${products\n      .map(\n        ({ _id, name, img, category, size, price }) => `\n      <li class=\"cart-product-item\" data-product-id=\"${_id}\">\n        <div class=\"cart-product-container\">\n          <div class=\"cart-product-img-container\">\n            <img src=\"${img}\" alt=\"${name}\" width=\"64\" height=\"64\" class=\"cart-product-img\">\n          </div>\n          <div class=\"cart-product-parameter-container\">\n            <h2 class=\"cart-product-title\">${name}</h2>\n            <div class=\"cart-product-parameter-text\">\n            <p class=\"cart-product-parameter\">Category: <span class=\"cart-span-parameter-value\">${\n              category ? category.replace(/_/g, ' ') : ''\n            }</span></p>\n            <p class=\"cart-product-parameter\">Size: <span class=\"cart-span-parameter-value\">${size}</span></p>\n            </div>\n            <p class=\"price\">$${price}</p>\n          </div>\n          <div class=\"cart-delete\">\n            <button type=\"button\" class=\"cart-btn-delete\">\n              <span class=\"cart-icon-close\">\n                <svg class=\"icon-close\" width=\"18\" height=\"18\">\n                  <use href=\"${icons}#icon-ion_close-sharp\"></use>\n                </svg>\n              </span>\n            </button>\n          </div>\n        </div>\n      </li>`\n      )\n      .join('')}\n  </ul>\n  </div>\n`;\n\nexport const getcheckoutMarkup = (products) =>{\n  let prices = 0;\n  products.forEach(({ price }) => (prices += price));\n        return`\n    <div>\n      <h2 class=\"checkout-title\">Your order</h2>\n      <div class=\"checkout-total-wrap\">\n        <p class=\"checkout-text\">Total</p>\n        <p class=\"checkout-total\">$${prices.toFixed(2)}</p>\n      </div>\n\n      <div class=\"checkout-input-wrap\">\n        <label class=\"checkout-input-label\" for=\"checkoutEmail\"></label>\n        <input\n          class=\"checkout-input-email\"\n          type=\"email\"\n          id=\"checkoutEmail\"\n          name=\"email\"\n          placeholder=\"example@mail.com:\"\n          required\n        />\n        <button class=\"checkout-button\" type=\"submit\">Checkout</button>\n        </div>\n        `};\n","import ApiService from './requests';\nimport { ShopStorage } from './local-storage';\nimport {\n  getEmptyCartMarkup,\n  getCartMarkup,\n  getcheckoutMarkup,\n} from './markup_cart';\nimport { updateCartCounter} from './header';\n\nconst basket = document.getElementById('basket');\nconst cartTitle = document.getElementById('cart-counter-page');\nconst storage = new ShopStorage('productsBasket');\nconst api = new ApiService();\n\nasync function updateCart() {\n  const products = storage.getAllProducts();\n  console.log('Current products in storage:', products); //проверка\n  // Формування розмітки контейнерів. якщо кошик порожній відмальовується Empty, у іншову випадку відмальовується розмітка CART\n  if (products.length === 0) {\n    console.log('Basket is empty. Displaying empty cart markup.'); //проверка\n    basket.innerHTML = '';\n    basket.insertAdjacentHTML('beforeend', getEmptyCartMarkup());\n  } else {\n    console.log('Fetching product details for each product in the cart.'); //проверка\n    const productDetailsPromises = products.map(async ({ _id, quantity }) => {\n      try {\n        if (_id) {\n          const productDetails = await api.getProductById(_id);\n          return { ...productDetails, quantity };\n        } else {\n          console.error('_id is undefined or empty for a product in the cart');\n          return null;\n        }\n      } catch (error) {\n        console.error(`Error fetching product details for _id: ${_id}`, error);\n        return null;\n      }\n    });\n\n    const productDetailsArray = await Promise.all(productDetailsPromises);\n     const validProductDetails = productDetailsArray.filter(\n      details => details !== null\n    );\n    console.log(\n      'Displaying cart markup with product details:',\n      validProductDetails\n    ); //проверка\n    basket.innerHTML = '';\n    basket.insertAdjacentHTML('beforeend', getCartMarkup(validProductDetails));\n    basket.insertAdjacentHTML('beforeend', getcheckoutMarkup(validProductDetails));\n  }\n \n  const productCount = products.length;\n  console.log('Updating cart counter with product count:', productCount); //проверка\n  cartTitle.textContent = `CART (${productCount})`;\n}\n\n// !=================================================\nexport async function renCart() {\n   await updateCart();\n  const refs = {\n    totalPriceElement: document.querySelector('.checkout-total'),\n    emailInput: document.querySelector('.checkout-input-email'),\n    checkoutButton: document.querySelector('.checkout-button'),\n    cartContainer: document.querySelector('.cart-products-list'),\n    price: document.querySelector('.price'),\n  };\n  return refs\n}\nrenCart()\n// !=================================================\ndocument.addEventListener('DOMContentLoaded', () => {\n  document.body.addEventListener('click', async event => {\n    const btnDeleteAll = event.target.closest('.btn-delete-all');\n    const btnDelete = event.target.closest('.cart-btn-delete');\n\n    if (btnDeleteAll) {\n      console.log('Deleting all products from storage.');\n      storage.removeAllProducts();\n      console.log('Updating cart after removing all products.');\n      updateCart();\n    } else if (btnDelete) {\n      const productId =\n        btnDelete.closest('.cart-product-item').dataset.productId;\n      console.log(`Deleting product with ID: ${productId}`);\n      storage.removeProduct(productId); // ИЗМЕНЕНИЕ\n      updateCart();\n    }\n\t updateCartCounter ();\n  });\n});\n","// Імпорт\nimport {renCart} from './cart_products'\nimport ApiService from './requests';\nimport {\n  getEmptyCartMarkup,\n  getCartMarkup,\n  getcheckoutMarkup,\n} from './markup_cart';\nimport { ShopStorage } from './local-storage';\nconst api = new ApiService();\nconst storage = new ShopStorage('productsBasket');\n\ndocument.addEventListener('DOMContentLoaded', async function () {\n  const products = storage.getAllProducts();\nconst productDetailsPromises = products.map(async ({ _id, quantity }) => {\n  try {\n    if (_id) {\n      const productDetails = await api.getProductById(_id);\n      return { ...productDetails, quantity };\n    } else {\n      console.error('_id is undefined or empty for a product in the cart');\n      return null;\n    }\n  } catch (error) {\n    console.error(`Error fetching product details for _id: ${_id}`, error);\n    return null;\n  }\n});\n\nconst productDetailsArray = await Promise.all(productDetailsPromises);\nconst validProductDetails = productDetailsArray.filter(\n  details => details !== null\n);\n\n await renCart();\n  // Референси\n  const refs = {\n    totalPriceElement: document.querySelector('.checkout-total'),\n    emailInput: document.querySelector('.checkout-input-email'),\n    checkoutButton: document.querySelector('.checkout-button'),\n    cartContainer: document.querySelector('.cart-products-list'),\n    price: document.querySelector('.price'),\n  };\n  let sum = 0;\n  function summ() {\n    validProductDetails.map(({price}) => sum += price)\n    refs.totalPriceElement.textContent = `$${sum.toFixed(2)}`;\n  }\n  summ()\n  \n\n\n\n  refs.checkoutButton.addEventListener('click', handleCheckout);\n  function handleCheckout(event) {\n    event.preventDefault();\n    checkout();\n  }\n \n  // Функція чекаута\n  function checkout() {\n    const emailValue = refs.emailInput.value;\n\n    // Валідація в інпуті\n    if (!emailValue || !isValidEmail(emailValue)) {\n      alert('Please enter a valid email address.');\n      return;\n    }\n    function carMar() {\n      const cartMarkup = getEmptyCartMarkup();\n      refs.cartContainer.innerHTML = cartMarkup;\n\n      }\n    // Завантажує правильну розмітку: або порожню корзину, або товари й ціну\n    if( products.length > 0) carMar();\n   \n    \n\n    // Повідомлення про успішний чекаут\n    alert(`Checkout completed! Total Price: $${sum.toFixed(2)}.`);\n\n    // Скидає в нуль\n    refs.totalPriceElement.textContent = '0.00';\n\n    // Чистить сховище\n    localStorage.clear();\n  }\n\n  // Валідація пошти\n  function isValidEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n});\n\n"],"names":["imgecd_1x","imgecd_2x","imgect_1x","imgect_2x","imgecm_1x","imgecm_2x","getEmptyCartMarkup","getCartMarkup","products","_id","name","img","category","size","price","icons","getcheckoutMarkup","prices","basket","cartTitle","storage","ShopStorage","api","ApiService","updateCart","productDetailsPromises","quantity","error","validProductDetails","details","productCount","renCart","event","btnDeleteAll","btnDelete","productId","updateCartCounter","refs","sum","summ","handleCheckout","checkout","emailValue","isValidEmail","carMar","cartMarkup","email"],"mappings":"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"}