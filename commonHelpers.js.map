{"version":3,"file":"commonHelpers.js","sources":["../src/js/markup_cart.js","../src/js/cart_products.js","../src/js/cart_checkout.js"],"sourcesContent":["\nexport const getEmptyCartMarkup = () =>\n    `\n      <picture>\n          <source\n            srcset=\"\n              ./img/empty_cart/empty-cart-desktop-1x.png 1x,\n              ./img/empty_cart/empty-cart-desktop-2x.png 2x\n            \"\n            media=\"\n            (min-width: 1440px)\"\n          />\n          <source\n            srcset=\"\n              ./img/empty_cart/empty-cart-tab-1x.png 1x,\n              ./img/empty_cart/empty-cart-tab-2x.png 2x\n            \"\n            media=\"\n            (min-width: 768px)\"\n          />\n          <source\n            srcset=\"\n              ./img/empty_cart/empty-cart-mob-1x.png 1x,\n              ./img/empty_cart/empty-cart-mob-2x.png 2x\n            \"\n            media=\"\n            (min-width: 375px)\"\n          />\n          <img\n            src=\"./img/empty_cart/empty-cart-mob-1x.png\"\n            alt=\"Empty Cart Image\"\n            class=\"empty-cart-image\"\n          />\n        </picture>\n        <h2 class=\"empty-cart-title\">\n          Your basket is <span class=\"empty-cart-title-span\">empty...</span>\n        </h2>\n        <p class=\"empty-cart-text\">\n          Go to the main page to select your favorite products and add them to\n          the cart.\n        </p>\n    `;\n\n\n\nexport const getCartMarkup = (products) =>\n    `\n     <div class=\"delete-all\">\n    <button type=\"button\" class=\"btn-delete-all\"> Delete All \n      <span class=\"icon-close-sharp\">\n        <svg class=\"icon-basket\" width=\"24\" height=\"24\">\n          <use href=\"/img/symbol-defs.svg#icon-ion_close-sharp\"></use>\n        </svg>\n      </span>\n    </button>\n  </div>\n  <ul class=\"cart-products-list\">\n    ${products.map(({ _id, name, img, category, size, price }) => `\n      <li class=\"cart-product-item\" data-product-id=\"${_id}\">\n        <div class=\"cart-product-container\">\n          <div class=\"cart-product-img-container\">\n            <img src=\"${img}\" alt=\"${name}\" width=\"64\" height=\"64\" class=\"cart-product-img\">\n          </div>\n          <div class=\"cart-product-parameter-container\">\n            <h2 class=\"cart-product-title\">${name}</h2>\n            <p class=\"cart-product-parameter\">Category: <span class=\"cart-span-parameter-value\">${category ? category.replace(/_/g, ' ') : ''}</span></p>\n            <p class=\"cart-product-parameter\">Size: <span class=\"cart-span-parameter-value\">${size}</span></p>\n            <p class=\"price\">$${price}</p>\n          </div>\n          <div class=\"cart-delete\">\n            <button type=\"button\" class=\"cart-btn-delete\">\n              <span class=\"cart-icon-close-sharp\">\n                <svg class=\"icon-basket\" width=\"24\" height=\"24\">\n                  <use href=\"/img/symbol-defs.svg#icon-ion_close-sharp\"></use>\n                </svg>\n              </span>\n            </button>\n          </div>\n        </div>\n      </li>`).join('')}\n  </ul>\n`;\n\nexport const getcheckoutMarkup = () =>`\n     <h2 class=\"checkout-title\">Your order</h2>\n      <div class=\"checkout-total-wrap\">\n        <p class=\"checkout-text\">Total</p>\n        <p class=\"checkout-total\">$0.00</p>\n      </div>\n\n      <div class=\"checkout-input-wrap\">\n        <label for=\"checkoutEmail\"></label>\n        <input\n          class=\"checkout-input-email\"\n          type=\"email\"\n          id=\"checkoutEmail\"\n          name=\"email\"\n          placeholder=\"Mail:\"\n          required\n        />\n        <button class=\"checkout-button\" type=\"submit\">Checkout</button>\n        `;\n","\nimport ApiService from './requests';\nimport { ShopStorage } from './local-storage';\nimport { getEmptyCartMarkup, getCartMarkup, getcheckoutMarkup } from './markup_cart';\n\n\n  const basket = document.getElementById('basket');\n  const cartTitle = document.getElementById('cart-counter-page');\n  const storage = new ShopStorage('productsBasket');\n  const api = new ApiService();\n\n  async function updateCart() {\n    const products = storage.getAllProducts();\n  console.log('Current products in storage:', products); //проверка\n// Формування розмітки контейнерів. якщо кошик порожній відмальовується Empty, у іншову випадку відмальовується розмітка CART\n    if (products.length === 0) {\n      console.log('Basket is empty. Displaying empty cart markup.'); //проверка\n      basket.innerHTML = '';\n      basket.insertAdjacentHTML('beforeend', getEmptyCartMarkup());\n    } else {\n        console.log('Fetching product details for each product in the cart.'); //проверка\n      const productDetailsPromises = products.map(async ({ _id, quantity }) => {\n        try {\n          if (_id) {\n      const productDetails = await api.getProductById(_id);\n      return { ...productDetails, quantity };\n    } else {\n      console.error('_id is undefined or empty for a product in the cart');\n      return null;\n    }\n  } catch (error) {\n    console.error(`Error fetching product details for _id: ${_id}`, error);\n    return null;\n  }\n        \n        });\n\n      const productDetailsArray = await Promise.all(productDetailsPromises);\n      const validProductDetails = productDetailsArray.filter(details => details !== null);\nconsole.log('Displaying cart markup with product details:', validProductDetails); //проверка\n      basket.innerHTML = '';\n      basket.insertAdjacentHTML('beforeend', getCartMarkup(validProductDetails));\n      basket.insertAdjacentHTML('beforeend', getcheckoutMarkup());\n    }\n\n    const productCount = products.length;\n    console.log('Updating cart counter with product count:', productCount); //проверка\n    cartTitle.textContent = `CART (${productCount})`;\n  }\n\n  updateCart();\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  document.body.addEventListener('click', async (event) => {\n    const btnDeleteAll = event.target.closest('.btn-delete-all');\n    const btnDelete = event.target.closest('.cart-btn-delete');\n\n    if (btnDeleteAll) {\n      console.log('Deleting all products from storage.');\n      storage.removeAllProducts();\n      console.log('Updating cart after removing all products.');\n      updateCart();\n    } else if (btnDelete) {\n      const productId = btnDelete.closest('.cart-product-item').dataset.productId;\n      console.log(`Deleting product with ID: ${productId}`);\n      storage.removeProduct(productId); // ИЗМЕНЕНИЕ\n      updateCart();\n    }\n  });\n});\n\n\n\n\n\n\n\n\n\n","let cartItems = [];\n\n// Референси\nconst refs = {\n  //   cartList: document.querySelector(\".cart-product-list\"),\n  totalPriceElement: document.getElementById('totalPrice'),\n  emailInput: document.querySelector('.checkout-input-email'),\n  inputWrap: document.querySelector('.checkout-input-wrap'),\n  checkoutTitle: document.querySelector('.checkout-title'),\n  checkoutTotalWrap: document.querySelector('.checkout-total-wrap'),\n  emptyCartContainer: document.querySelector('.empty-cart-container'),\n  checkoutButton: document.querySelector('.checkout-button'),\n};\n\n// Function to handle the checkout button click\nfunction checkout() {\n  const emailValue = refs.emailInput.value;\n\n  // Check if the total amount is greater than 0 and the cart is not empty\n  if (cartItems.length === 0 || getTotalPrice() === 0) {\n    alert('Cannot proceed with checkout. Cart is empty or total amount is 0.');\n    return;\n  }\n\n  // Validate email input\n  if (!emailValue || !isValidEmail(emailValue)) {\n    alert('Please enter a valid email address.');\n    return;\n  }\n\n  // Perform checkout process (customize this part based on your needs)\n  alert(\n    `Checkout completed! Total Price: $${getTotalPrice()}. Email: ${emailValue}`\n  );\n\n  // Reset the total price to 0\n  refs.totalPriceElement.textContent = '0.00';\n\n  // Clear the cartItems array\n  cartItems = [];\n\n  // Hide the checkout container\n  if (refs.inputWrap) {\n    refs.inputWrap.style.display = 'none';\n  }\n\n  // Hide checkout title and total-wrap\n  if (refs.checkoutTitle && refs.checkoutTotalWrap) {\n    refs.checkoutTitle.style.display = 'none';\n    refs.checkoutTotalWrap.style.display = 'none';\n  }\n\n  // Show the empty cart message\n  if (refs.emptyCartContainer) {\n    refs.emptyCartContainer.style.display = 'block';\n  }\n\n  // Clear local storage\n  localStorage.clear();\n}\n\n// Function to update the total price\nfunction updateTotalPrice() {\n  refs.totalPriceElement.textContent = getTotalPrice();\n}\n\n// Function to check if the email is valid\nfunction isValidEmail(email) {\n  // Regular expression for simple email validation\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// Function to get the total price of items in the cart\nfunction getTotalPrice() {\n  return cartItems.reduce((total, item) => total + item.price, 0).toFixed(2);\n}\n\n// EventListener на кнопку Checkout\nrefs.checkoutButton.addEventListener('click', handleCheckout);\nfunction handleCheckout(event) {\n  event.preventDefault();\n\n  checkout();\n}\n"],"names":["getEmptyCartMarkup","getCartMarkup","products","_id","name","img","category","size","price","getcheckoutMarkup","basket","cartTitle","storage","ShopStorage","api","ApiService","updateCart","productDetailsPromises","quantity","error","validProductDetails","details","productCount","event","btnDeleteAll","btnDelete","productId","cartItems","refs","checkout","emailValue","getTotalPrice","isValidEmail","email","total","item","handleCheckout"],"mappings":"kGACO,MAAMA,EAAqB,IAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA2CSC,EAAiBC,GAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWEA,EAAS,IAAI,CAAC,CAAE,IAAAC,EAAK,KAAAC,EAAM,IAAAC,EAAK,SAAAC,EAAU,KAAAC,EAAM,MAAAC,CAAK,IAAO;AAAA,uDACXL;AAAA;AAAA;AAAA,wBAG/BE,WAAaD;AAAA;AAAA;AAAA,6CAGQA;AAAA,kGACqDE,EAAWA,EAAS,QAAQ,KAAM,GAAG,EAAI;AAAA,8FAC7CC;AAAA,gCAC9DC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAYpB,EAAE,KAAK,EAAE;AAAA;AAAA,EAIRC,EAAoB,IAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UC7E9BC,EAAS,SAAS,eAAe,QAAQ,EACzCC,EAAY,SAAS,eAAe,mBAAmB,EACvDC,EAAU,IAAIC,EAAY,gBAAgB,EAC1CC,EAAM,IAAIC,EAEhB,eAAeC,GAAa,CAC1B,MAAMd,EAAWU,EAAQ,iBAGzB,GAFF,QAAQ,IAAI,+BAAgCV,CAAQ,EAE9CA,EAAS,SAAW,EACtB,QAAQ,IAAI,gDAAgD,EAC5DQ,EAAO,UAAY,GACnBA,EAAO,mBAAmB,YAAaV,EAAoB,CAAA,MACtD,CACH,QAAQ,IAAI,wDAAwD,EACtE,MAAMiB,EAAyBf,EAAS,IAAI,MAAO,CAAE,IAAAC,EAAK,SAAAe,KAAe,CACvE,GAAI,CACF,OAAIf,EAED,CAAE,GADc,MAAMW,EAAI,eAAeX,CAAG,EACvB,SAAAe,IAE5B,QAAQ,MAAM,qDAAqD,EAC5D,KAEV,OAAQC,EAAP,CACA,eAAQ,MAAM,2CAA2ChB,IAAOgB,CAAK,EAC9D,IACR,CAEH,CAAS,EAGGC,GADsB,MAAM,QAAQ,IAAIH,CAAsB,GACpB,OAAOI,GAAWA,IAAY,IAAI,EACxF,QAAQ,IAAI,+CAAgDD,CAAmB,EACzEV,EAAO,UAAY,GACnBA,EAAO,mBAAmB,YAAaT,EAAcmB,CAAmB,CAAC,EACzEV,EAAO,mBAAmB,YAAaD,EAAmB,CAAA,CAC3D,CAED,MAAMa,EAAepB,EAAS,OAC9B,QAAQ,IAAI,4CAA6CoB,CAAY,EACrEX,EAAU,YAAc,SAASW,IAClC,CAEDN,IAEF,SAAS,iBAAiB,mBAAoB,IAAM,CAClD,SAAS,KAAK,iBAAiB,QAAS,MAAOO,GAAU,CACvD,MAAMC,EAAeD,EAAM,OAAO,QAAQ,iBAAiB,EACrDE,EAAYF,EAAM,OAAO,QAAQ,kBAAkB,EAEzD,GAAIC,EACF,QAAQ,IAAI,qCAAqC,EACjDZ,EAAQ,kBAAiB,EACzB,QAAQ,IAAI,4CAA4C,EACxDI,YACSS,EAAW,CACpB,MAAMC,EAAYD,EAAU,QAAQ,oBAAoB,EAAE,QAAQ,UAClE,QAAQ,IAAI,6BAA6BC,GAAW,EACpDd,EAAQ,cAAcc,CAAS,EAC/BV,GACD,CACL,CAAG,CACH,CAAC,ECrED,IAAIW,EAAY,CAAA,EAGhB,MAAMC,EAAO,CAEX,kBAAmB,SAAS,eAAe,YAAY,EACvD,WAAY,SAAS,cAAc,uBAAuB,EAC1D,UAAW,SAAS,cAAc,sBAAsB,EACxD,cAAe,SAAS,cAAc,iBAAiB,EACvD,kBAAmB,SAAS,cAAc,sBAAsB,EAChE,mBAAoB,SAAS,cAAc,uBAAuB,EAClE,eAAgB,SAAS,cAAc,kBAAkB,CAC3D,EAGA,SAASC,GAAW,CAClB,MAAMC,EAAaF,EAAK,WAAW,MAGnC,GAAID,EAAU,SAAW,GAAKI,EAAa,IAAO,EAAG,CACnD,MAAM,mEAAmE,EACzE,MACD,CAGD,GAAI,CAACD,GAAc,CAACE,EAAaF,CAAU,EAAG,CAC5C,MAAM,qCAAqC,EAC3C,MACD,CAGD,MACE,qCAAqCC,EAAa,aAAcD,GACpE,EAGEF,EAAK,kBAAkB,YAAc,OAGrCD,EAAY,CAAA,EAGRC,EAAK,YACPA,EAAK,UAAU,MAAM,QAAU,QAI7BA,EAAK,eAAiBA,EAAK,oBAC7BA,EAAK,cAAc,MAAM,QAAU,OACnCA,EAAK,kBAAkB,MAAM,QAAU,QAIrCA,EAAK,qBACPA,EAAK,mBAAmB,MAAM,QAAU,SAI1C,aAAa,MAAK,CACpB,CAQA,SAASI,EAAaC,EAAO,CAG3B,MADmB,6BACD,KAAKA,CAAK,CAC9B,CAGA,SAASF,GAAgB,CACvB,OAAOJ,EAAU,OAAO,CAACO,EAAOC,IAASD,EAAQC,EAAK,MAAO,CAAC,EAAE,QAAQ,CAAC,CAC3E,CAGAP,EAAK,eAAe,iBAAiB,QAASQ,CAAc,EAC5D,SAASA,EAAeb,EAAO,CAC7BA,EAAM,eAAc,EAEpBM,GACF"}